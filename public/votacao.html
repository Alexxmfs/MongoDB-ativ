<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Votação Reality Show</title>
    <style>
        body { font-family: sans-serif; background-color: #f4f4f9; color: #333; }
        .container { max-width: 900px; margin: 20px auto; padding: 20px; }
        h1, h2 { text-align: center; }
        .participantes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .card { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 15px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .card h3 { margin-top: 0; }
        .card button { background-color: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; transition: background-color 0.2s; }
        .card button:hover { background-color: #0056b3; }
    </style>
</head>
<body>

    <div class="container">
        <h1 id="reality-nome">Carregando Reality Show...</h1>
        <h2>Vote no seu participante favorito!</h2>
        <!-- Container onde os participantes serão exibidos dinamicamente -->
        <div id="participantes-grid" class="participantes-grid"></div>
    </div>

    <script>
        // 1. Quando a página carregar, busque os dados dos participantes
        document.addEventListener('DOMContentLoaded', function() {
            // Nome do reality que queremos exibir. Deve ser igual ao que está no banco.
            const realityNome = "Big Brother Brasil"; 
            carregarParticipantes(realityNome);
        });

        // 2. Função para buscar os dados na nossa API e exibir na tela
        async function carregarParticipantes(nomeDoReality) {
            const grid = document.getElementById('participantes-grid');
            const titulo = document.getElementById('reality-nome');
            
            try {
                // Faz uma chamada GET para o novo endpoint que criamos no server.js
                const response = await fetch(`/reality/${encodeURIComponent(nomeDoReality)}`);
                const reality = await response.json();

                if (reality.message) {
                    throw new Error(reality.message);
                }

                titulo.textContent = reality.nome_reality;
                grid.innerHTML = ''; // Limpa a grid antes de adicionar os novos cards

                // Para cada participante encontrado, cria um card
                reality.participantes.forEach(p => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <h3>${p.nome_participante}</h3>
                        <p>Idade: ${p.idade}</p>
                        <button onclick="votar('${reality._id}', '${p.nome_participante}')">Votar</button>
                    `;
                    grid.appendChild(card);
                });

            } catch (error) {
                grid.innerHTML = `<p style="color: red; text-align: center;">Erro ao carregar participantes: ${error.message}</p>`;
                titulo.textContent = "Erro";
            }
        }

        // 3. Função para registrar um voto quando o botão é clicado
        async function votar(realityId, participanteNome) {
            try {
                // Faz uma chamada POST para o endpoint de votação
                const response = await fetch(`/votar/${realityId}/${encodeURIComponent(participanteNome)}`, {
                    method: 'POST'
                });

                const result = await response.json();

                if (result.success) {
                    alert('Obrigado pelo seu voto!');
                } else {
                    throw new Error(result.message);
                }

            } catch (error) {
                alert(`Erro ao registrar voto: ${error.message}`);
            }
        }
    </script>

</body>
</html>